# Time-based One Time Passwords (TOTP)
## Synopsis
The library provides ease of use for handling common TOTPs.

All examples here are given for the standard purpose to use with widely-spread TOTP apps.

The initial code and idea was taken from j256's [two-factor-auth](https://github.com/j256/two-factor-auth).

## Maven Coordinates

```
<dependency>
	<groupId>eu.ralph-schuster</groupId>
	<artifactId>jackson</artifactId>
	<version>${version}</version>
</dependency>
```

## API Reference

Javadoc API for latest stable version can be accessed [here](https://www.javadoc.io/doc/eu.ralph-schuster/totp).

# Usage

## Creating Secrets
You can create secrets randomly or from existing encodings or bytes:

```
// Create a random secret (standard keys)
ISecret secret = Base32Secret.generate();

// Create a secret from string
ISecret secret = new Base32Secret(base32EncodedSecret);

// Create a secret from bytes
ISecret secret = new Base32Secret(secretBytes);

```

## Creating the TOTP generator
Before you begin, you need a ``TotpGen`` object:

```
// Create with default length of 6 digits and 30 seconds time step
TotpGen totp = new TotpGen(secret);

// Create with length of 8 digits and 60 seconds time step
TotpGen totp = new TotpGen(secret, 8, 60);
```

## Sharing a TOTP with your users
You can share your TOTP with your user by either giving them the URI:

```
// Set issuer and account directly
String issuer  = "My App name";
String account = "user@example.com";
URI uri = totp.getUri(issuer, account);

// Store issuer and account with the TOTP
totp.setIssuer("My app name");
totp.setAccount("user@example.com");
URI uri = totp.getUri();
```

You can use the URI to generate a QR code by yourself (recommended) or
have it generated by Google API. Latter is not recommended due to security
concerns.

```
// with issuer/account from TOTP and default dimension
URL imageURL = GoogleApiQrGenerator.getQrImageUrl(totp);

// with default dimension
URL imageURL = GoogleApiQrGenerator.getQrImageUrl(totp, issuer, account);

// with given dimension
URL imageURL = GoogleApiQrGenerator.getQrImageUrl(totp, 500);
URL imageURL = GoogleApiQrGenerator.getQrImageUrl(totp, issuer, account, 500);
```

## Verifying TOTPs
Request a TOTP from your user and verify with:

```
// Verify without any time tolerance
boolean isValid = totp.verify(userInput);

// Verify within a time tolerance of 10secs
boolean isValid = totp.verify(userInput, 10000L);
```

You should use the tolerated verification to allow any synchronization issues with your user.

## Get the current TOTP
In case you need the current TOTP, use:

```
String code = totp.current();
```

## Create TOTP generators from URIs
You can create a TOTP also from a URI that you got somewhere (or created yourself):

```
TotpGen totp = TotpGen.from(uri);
```

The method follows the Google sepcification for [TOTP URIs](https://github.com/google/google-authenticator/wiki/Key-Uri-Format).

# Contributions

 * [Project Homepage](https://github.com/technicalguru/rslibs/totp)
 * [Issue Tracker](https://github.com/technicalguru/rslibs/issues)
 
# License

RsLibs is free software: you can redistribute it and/or modify it under the terms of version 3 of the GNU 
Lesser General Public  License as published by the Free Software Foundation.

RsLibs is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied 
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public 
License for more details.

You should have received a copy of the GNU Lesser General Public License along with RsLibs.  If not, see 
<http://www.gnu.org/licenses/lgpl-3.0.html>.

Summary:
 1. You are free to use all this code in any private or commercial project. 
 2. You must distribute license and author information along with your project.
 3. You are not required to publish your own source code.

